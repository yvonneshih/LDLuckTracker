<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Love & Deepspace - Gacha Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 1rem; }
    h1 { text-align: center; }
    input, select, button, textarea {
      width: 100%; padding: 0.5rem; margin: 0.4rem 0; font-size: 1rem;
    }
    table { width: 100%; margin-top: 1rem; border-collapse: collapse; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: center; font-size: 0.9rem; }
    .charts { display: flex; flex-direction: column; gap: 2rem; margin-top: 2rem; }
    canvas { background: #fff; border: 1px solid #ddd; padding: 0.5rem; border-radius: 8px; max-width: 100%; }
    .chart-container { text-align: center; }
    .chart-controls { display: flex; justify-content: center; gap: 0.5rem; margin: 0.5rem 0; flex-wrap: wrap; }
    #luckSummary { margin-top: 2rem; padding: 1rem; background: #fff3cd; border: 1px solid #ffeeba; border-radius: 8px; }
  </style>
</head>
<body>
<h1 id="title">ğŸŸï¸ Love & Deepspace â€“ Gacha Tracker</h1>
<label for="langSelect">ğŸŒ Language / è¯­è¨€:</label>
<select id="langSelect">
  <option value="en">English</option>
  <option value="zh">ä¸­æ–‡</option>
</select>
<form id="gachaForm">
  <select id="character" required>
    <option value="">Select Character</option>
    <option value="æ²ˆæ˜Ÿå›">æ²ˆæ˜Ÿå› (Xavier)</option>
    <option value="é»æ·±">é»æ·± (Zayne)</option>
    <option value="å¤ä»¥æ˜¼">å¤ä»¥æ˜¼ (Caleb)</option>
    <option value="ç¥ç…œ">ç¥ç…œ (Rafayel)</option>
    <option value="ç§¦å½»">ç§¦å½» (Sylus)</option>
  </select>
  <select id="cardType" required>
    <option value="">ğŸŒ™ or â˜€ï¸</option>
    <option value="Moon">ğŸŒ™ Moon</option>
    <option value="Sun">â˜€ï¸ Sun</option>
  </select>
  <select id="resultType" required>
    <option value="">Got 5â˜…?</option>
    <option value="event">Event 5â˜…</option>
    <option value="normal">Normal 5â˜…</option>
    <option value="none">No 5â˜…</option>
  </select>
  <input type="number" id="eventCount" min="0" placeholder="Number of Event 5â˜… Cards" />
  <input type="number" id="normalCount" min="0" placeholder="Number of Normal 5â˜… Cards (optional)" />
  <input type="number" id="tickets" min="1" placeholder="Tickets Used" required />
  <input type="date" id="drawDate" />
  <textarea id="memo" placeholder="Memo (optional)"></textarea>
  <button type="submit">Add Record</button>
</form>
<div>
  <button onclick="clearData()">ğŸ§¼ Clear All Data</button>
</div>
<table>
  <thead>
    <tr><th>Date</th><th>Character</th><th>Type</th><th>Result</th><th>Event 5â˜…</th><th>Normal 5â˜…</th><th>Tickets</th><th>Memo</th></tr>
  </thead>
  <tbody id="history"></tbody>
</table>
<div id="luckSummary"></div>
<div class="charts">
  <div class="chart-container">
    <h3 id="drawsCharTitle">Draws per Character</h3>
    <canvas id="charChart"></canvas>
  </div>
  <div class="chart-container">
    <h3 id="drawsEventTitle">Draws for Event 5â˜…</h3>
    <canvas id="eventChart"></canvas>
  </div>
</div>
<script>
let history = JSON.parse(localStorage.getItem("gachaHistory") || "[]");
const table = document.getElementById("history");
const charts = {};

const translations = {
  en: {
    title: "ğŸŸï¸ Love & Deepspace â€“ Gacha Tracker",
    drawsChar: "Draws per Character",
    drawsEvent: "Draws for Event 5â˜…"
  },
  zh: {
    title: "ğŸŸï¸ æ‹ä¸æ·±ç©º â€“ æŠ½å¡è®°å½•å™¨",
    drawsChar: "æ¯ä½è§’è‰²æŠ½å¡æ€»æ•°",
    drawsEvent: "æ¯ä½è§’è‰²æ´»åŠ¨å¡æŠ½å¡æ•°"
  }
};

document.getElementById("langSelect").addEventListener("change", e => {
  const lang = e.target.value;
  const t = translations[lang];
  document.getElementById("title").textContent = t.title;
  document.getElementById("drawsCharTitle").textContent = t.drawsChar;
  document.getElementById("drawsEventTitle").textContent = t.drawsEvent;
});

function addRow(r) {
  const tr = document.createElement("tr");
  tr.innerHTML = `<td>${r.date}</td><td>${r.character}</td><td>${r.type}</td><td>${r.result}</td>
    <td>${r.eventCount || 0}</td><td>${r.normalCount || 0}</td><td>${r.tickets}</td><td>${r.memo}</td>`;
  table.appendChild(tr);
}
history.forEach(addRow);

document.getElementById("gachaForm").addEventListener("submit", e => {
  e.preventDefault();
  const record = {
    character: document.getElementById("character").value,
    type: document.getElementById("cardType").value,
    result: document.getElementById("resultType").value,
    eventCount: parseInt(document.getElementById("eventCount").value || 0),
    normalCount: parseInt(document.getElementById("normalCount").value || 0),
    tickets: parseInt(document.getElementById("tickets").value),
    date: document.getElementById("drawDate").value || "â€”",
    memo: document.getElementById("memo").value || "â€”"
  };
  history.push(record);
  localStorage.setItem("gachaHistory", JSON.stringify(history));
  addRow(record);
  updateCharts();
  updateLuckSummary();
  e.target.reset();
});

function clearData() {
  if (confirm("Clear all data?")) {
    localStorage.removeItem("gachaHistory");
    history = [];
    table.innerHTML = "";
    updateCharts();
    updateLuckSummary();
  }
}

function getSumByCharacter(filter) {
  const map = {};
  history.forEach(r => {
    if (!filter || filter(r)) {
      map[r.character] = (map[r.character] || 0) + r.tickets;
    }
  });
  return map;
}

function drawChart(id, dataMap) {
  const ctx = document.getElementById(id).getContext("2d");
  const labels = Object.keys(dataMap);
  const data = Object.values(dataMap);
  if (charts[id]) charts[id].destroy();
  charts[id] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels,
      datasets: [{
        label: 'Draws',
        data,
        backgroundColor: '#76b5c5'
      }]
    },
    options: { responsive: true }
  });
}

function updateCharts() {
  drawChart("charChart", getSumByCharacter());
  drawChart("eventChart", getSumByCharacter(r => r.result === "event"));
}

function updateLuckSummary() {
  let pity = 0;
  let totalEvent = 0;
  let luckRatings = [];

  for (let i = 0; i < history.length; i++) {
    const entry = history[i];
    if (entry.result === 'none') {
      pity += entry.tickets;
    } else {
      pity += entry.tickets;
      if (entry.result === 'event' && entry.eventCount > 0) {
        totalEvent += entry.eventCount;
        const avg = pity / entry.eventCount;
        let label = avg <= 30 ? 'ğŸŸ¢ Super Lucky' : avg <= 50 ? 'ğŸ’š Lucky' : avg < 70 ? 'âšª Average' : avg === 70 ? 'ğŸŸ  Pity' : 'ğŸ”´ Unlucky';
        luckRatings.push(`${entry.date}: ${label} (${avg.toFixed(1)} pulls)`);
        pity = 0;
      }
    }
  }

  const summaryDiv = document.getElementById("luckSummary");
  summaryDiv.innerHTML = `<h3>ğŸ¯ Luck Summary</h3>
    <p>Total Event 5â˜…: ${totalEvent}</p>
    <p>Ratings:</p>
    <ul>${luckRatings.map(l => `<li>${l}</li>`).join('')}</ul>`;
}

updateCharts();
updateLuckSummary();
</script>
</body>
</html>
