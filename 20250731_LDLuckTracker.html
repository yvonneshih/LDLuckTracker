<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Love & Deepspace - Luck Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; padding: 1rem; background: #f5f5f5; }
    h1 { text-align: center; }
    select, input, button {
      padding: 0.5rem; margin: 0.3rem 0; width: 100%; font-size: 1rem;
    }
    table {
      width: 100%; border-collapse: collapse; margin-top: 1rem; background: white;
    }
    th, td {
      border: 1px solid #ccc; padding: 0.5rem; text-align: center;
    }
    .result {
      margin-top: 1rem; padding: 1rem; border: 2px solid #ccc; border-radius: 6px; background: #fff;
    }
    .luck { font-weight: bold; font-size: 1.1rem; }
    .controls { display: flex; gap: 0.5rem; margin-top: 1rem; }
  </style>
</head>
<body>

<h1 id="title">ğŸŸï¸ Love & Deepspace â€“ Luck Tracker</h1>

<label for="languageSelect" id="langLabel">ğŸŒ Language / è¯­è¨€:</label>
<select id="languageSelect">
  <option value="en">English</option>
  <option value="zh">ä¸­æ–‡</option>
</select>

<form id="gachaForm">
  <input type="text" id="eventName" placeholder="Event Name" required>
  <select id="eventCharacter" required>
    <option value="">Select Event Character</option>
    <option value="Xavier æ²ˆæ˜Ÿå›">Xavier æ²ˆæ˜Ÿå›</option>
    <option value="Zayne é»æ·±">Zayne é»æ·±</option>
    <option value="Caleb å¤ä»¥æ˜¼">Caleb å¤ä»¥æ˜¼</option>
    <option value="Rafayel ç¥ç…œ">Rafayel ç¥ç…œ</option>
    <option value="Sylus ç§¦å½»">Sylus ç§¦å½»</option>
  </select>
  <input type="number" id="ticketsUsed" placeholder="Yellow Tickets Used" min="1" required>
  <select id="cardType" required>
    <option value="">Got 5â˜… Card?</option>
    <option value="event">Yes - Event 5â˜…</option>
    <option value="normal">Yes - Normal 5â˜…</option>
    <option value="none">No 5â˜… Yet</option>
  </select>

  <select id="normalCharacter" style="display:none;">
    <option value="">Select Normal 5â˜… Character</option>
    <option value="Xavier æ²ˆæ˜Ÿå›">Xavier æ²ˆæ˜Ÿå›</option>
    <option value="Zayne é»æ·±">Zayne é»æ·±</option>
    <option value="Caleb å¤ä»¥æ˜¼">Caleb å¤ä»¥æ˜¼</option>
    <option value="Rafayel ç¥ç…œ">Rafayel ç¥ç…œ</option>
    <option value="Sylus ç§¦å½»">Sylus ç§¦å½»</option>
  </select>

  <input type="date" id="drawDate" placeholder="Optional Date">
  <button type="submit" id="submitBtn">Analyze & Record</button>
</form>

<div id="result" class="result" style="display:none;"></div>

<div class="controls">
  <button onclick="clearHistory()" id="clearBtn">ğŸ§¼ Clear History</button>
</div>

<table id="historyTable">
  <thead>
    <tr>
      <th id="thDate">Date</th>
      <th id="thEvent">Event</th>
      <th id="thChar">Event Character</th>
      <th id="thResultChar">Result Character</th>
      <th id="thTickets">Tickets</th>
      <th id="thType">Card Type</th>
      <th id="thLuck">Luck Level</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const form = document.getElementById('gachaForm');
  const cardTypeSelect = document.getElementById('cardType');
  const normalCharSelect = document.getElementById('normalCharacter');
  const langSelect = document.getElementById('languageSelect');
  const resultDiv = document.getElementById('result');
  const tableBody = document.querySelector('#historyTable tbody');
  const defaultLang = localStorage.getItem('lang') || 'en';
  let history = JSON.parse(localStorage.getItem('luckHistory') || '[]');
  let previousWasNormal = false;

  const translations = {
    en: {
      title: "ğŸŸï¸ Love & Deepspace â€“ Luck Tracker",
      langLabel: "ğŸŒ Language / è¯­è¨€:",
      submitBtn: "Analyze & Record",
      clearBtn: "ğŸ§¼ Clear History",
      placeholders: {
        eventName: "Event Name",
        tickets: "Yellow Tickets Used"
      },
      th: ["Date", "Event", "Event Character", "Result Character", "Tickets", "Card Type", "Luck Level"],
      cardLabels: {
        event: "Event 5â˜…",
        normal: "Normal 5â˜…",
        none: "None"
      }
    },
    zh: {
      title: "ğŸŸï¸ æ‹ä¸æ·±ç©º â€“ æ¬§æ°”è®°å½•å™¨",
      langLabel: "ğŸŒ è¯­è¨€ / Language:",
      submitBtn: "åˆ†æå¹¶è®°å½•",
      clearBtn: "ğŸ§¼ æ¸…é™¤è®°å½•",
      placeholders: {
        eventName: "æ´»åŠ¨åç§°",
        tickets: "ä½¿ç”¨é»„ç¥¨æ•°"
      },
      th: ["æ—¥æœŸ", "æ´»åŠ¨", "æ´»åŠ¨è§’è‰²", "ç»“æœè§’è‰²", "ç¥¨æ•°", "å¡ç±»å‹", "æ¬§æ°”ç­‰çº§"],
      cardLabels: {
        event: "æ´»åŠ¨5æ˜Ÿ",
        normal: "å¸¸è§„5æ˜Ÿ",
        none: "æœªå‡ºå¡"
      }
    }
  };

  function applyLanguage(lang) {
    const t = translations[lang];
    document.getElementById('title').textContent = t.title;
    document.getElementById('langLabel').textContent = t.langLabel;
    document.getElementById('submitBtn').textContent = t.submitBtn;
    document.getElementById('clearBtn').textContent = t.clearBtn;

    document.getElementById('eventName').placeholder = t.placeholders.eventName;
    document.getElementById('ticketsUsed').placeholder = t.placeholders.tickets;

    const ths = document.querySelectorAll('#historyTable thead th');
    t.th.forEach((txt, idx) => { ths[idx].textContent = txt; });
  }

  langSelect.value = defaultLang;
  applyLanguage(defaultLang);

  langSelect.addEventListener("change", () => {
    const lang = langSelect.value;
    localStorage.setItem('lang', lang);
    applyLanguage(lang);
  });

  cardTypeSelect.addEventListener("change", () => {
    normalCharSelect.style.display = cardTypeSelect.value === "normal" ? "block" : "none";
  });

  history.forEach(addToTable);

  form.addEventListener('submit', function (e) {
    e.preventDefault();

    const lang = langSelect.value;
    const t = translations[lang];

    const event = document.getElementById('eventName').value.trim();
    const eventChar = document.getElementById('eventCharacter').value;
    const tickets = parseInt(document.getElementById('ticketsUsed').value, 10);
    const cardType = cardTypeSelect.value;
    const normalChar = normalCharSelect.value;
    const date = document.getElementById('drawDate').value || 'â€”';

    let luckLevel = '', luckMessage = '', resultChar = '';

    if (cardType === 'none') {
      luckMessage = lang === 'zh' ? 'è¿˜æœªå‡ºå¡ï¼Œç»§ç»­æŠ½å§ï½' : 'Still pulling... No 5â˜… yet.';
      luckLevel = 'Pending';
      resultChar = 'â€”';
    } else if (cardType === 'event') {
      resultChar = eventChar;
      if (tickets <= 30) {
        luckMessage = 'ğŸŸ¢ Super Lucky!';
        luckLevel = lang === 'zh' ? 'è¶…çº§æ¬§çš‡' : 'Super Lucky';
      } else if (tickets <= 50) {
        luckMessage = 'ğŸ’š Lucky!';
        luckLevel = lang === 'zh' ? 'å°æ¬§' : 'Lucky';
      } else if (tickets < 70) {
        luckMessage = 'âšª Normal luck.';
        luckLevel = lang === 'zh' ? 'æ­£å¸¸' : 'Normal';
      } else {
        if (previousWasNormal) {
          luckMessage = 'âœ… Guaranteed Event after Normal. ğŸ” Reset.';
          previousWasNormal = false;
          luckLevel = lang === 'zh' ? 'ä¿åº•å‡ºæ´»åŠ¨å¡' : 'Guaranteed Event';
        } else {
          luckMessage = 'âš ï¸ Event 5â˜… at pity.';
          luckLevel = lang === 'zh' ? 'æ´»åŠ¨å¡ä¿åº•' : 'At Pity';
        }
      }
    } else if (cardType === 'normal') {
      resultChar = normalChar || 'â€”';
      previousWasNormal = true;
      if (tickets < 70) {
        luckMessage = 'ğŸŸ  Normal 5â˜… early â€” not great.';
        luckLevel = lang === 'zh' ? 'æ­ªäº†' : 'Unlucky';
      } else {
        luckMessage = 'ğŸ”´ Very unlucky! Got Normal 5â˜… at pity.';
        luckLevel = lang === 'zh' ? 'å¤§æ­ª' : 'Very Unlucky';
      }
    }

    resultDiv.style.display = 'block';
    resultDiv.innerHTML = `
      <p><strong>${t.th[1]}:</strong> ${event}</p>
      <p><strong>${t.th[2]}:</strong> ${eventChar}</p>
      <p><strong>${t.th[3]}:</strong> ${resultChar}</p>
      <p><strong>${t.th[4]}:</strong> ${tickets}</p>
      <p><strong>${t.th[5]}:</strong> ${t.cardLabels[cardType]}</p>
      <p class="luck">${luckMessage}</p>
    `;

    const drawRecord = {
      date, event, eventChar, resultChar, tickets, cardType, luckLevel
    };

    history.push(drawRecord);
    localStorage.setItem('luckHistory', JSON.stringify(history));
    addToTable(drawRecord);
    form.reset();
    normalCharSelect.style.display = "none";
  });

  function addToTable(draw) {
    const lang = langSelect.value;
    const t = translations[lang];
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${draw.date}</td>
      <td>${draw.event}</td>
      <td>${draw.eventChar}</td>
      <td>${draw.resultChar}</td>
      <td>${draw.tickets}</td>
      <td>${t.cardLabels[draw.cardType] || 'None'}</td>
      <td>${draw.luckLevel}</td>
    `;
    tableBody.appendChild(row);
  }

  function clearHistory() {
    if (confirm("Are you sure you want to clear all records?")) {
      localStorage.removeItem('luckHistory');
      tableBody.innerHTML = '';
      history = [];
      resultDiv.style.display = 'none';
    }
  }
</script>

</body>
</html>
